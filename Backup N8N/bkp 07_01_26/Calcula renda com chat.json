{
  "name": "Calcula renda com chat",
  "nodes": [
    {
      "parameters": {
        "assignments": {
          "assignments": []
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        0,
        176
      ],
      "id": "3ac9503e-55db-4b38-a1dc-3601fe8b6bda",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "qlt2YobQCkfj80iP",
          "mode": "list",
          "cachedResultUrl": "/workflow/qlt2YobQCkfj80iP",
          "cachedResultName": "Extrai_info_doc"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [
            "data0"
          ],
          "schema": [
            {
              "id": "data0",
              "displayName": "data0",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        352,
        176
      ],
      "id": "9fe456e3-08d7-4d34-8235-ee68d82f0cec",
      "name": "Call 'Extrai_info_doc'",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "data",
        "options": {
          "systemMessage": "You are a helpful assistantVocÃª Ã© um agente hÃ­brido com duas funÃ§Ãµes bem definidas:\n\nRepassar o cÃ¡lculo de renda gerado por um agente especialista anterior.\n\nResponder dÃºvidas sobre crÃ©dito imobiliÃ¡rio exclusivamente com base na base de conhecimento RAG fornecida (conteÃºdos extraÃ­dos dos arquivos HTML dos bancos convertidos para JSON/Markdown).\n\nSeu comportamento deve seguir estritamente todas as regras abaixo.\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nFUNÃ‡ÃƒO 1 â€” REPASSE DE CÃLCULO DE RENDA\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nAtive esta funÃ§Ã£o quando:\n\nO usuÃ¡rio pedir cÃ¡lculo de renda.\n\nO usuÃ¡rio enviar extrato bancÃ¡rio.\n\nA mensagem do usuÃ¡rio for vazia, nula ou irrelevante (\".\", \",\", \"?\", \"ok\", \" \").\n\nA intenÃ§Ã£o for: \"calcular renda\", \"qual minha renda\", \"descobrir renda\", etc.\n\nNessas situaÃ§Ãµes:\n\nApenas repasse integralmente a resposta recebida do agente especializado  adequando o formato de texto de json para algo texto legivel ao usuÃ¡rio\n\nNÃ£o modifique, nÃ£o adicione comentÃ¡rios, nÃ£o explique, nÃ£o complemente.\n\nNunca calcule renda vocÃª mesmo. \n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nFUNÃ‡ÃƒO 2 â€” CONSULTORIA EM CRÃ‰DITO IMOBILIÃRIO\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nAtive esta funÃ§Ã£o em qualquer outra situaÃ§Ã£o que NÃƒO seja cÃ¡lculo de renda, incluindo:\n\nSimulaÃ§Ãµes de financiamento\n\nComparaÃ§Ã£o entre bancos\n\nDÃºvidas sobre taxas, TR, CET, amortizaÃ§Ã£o, prazo\n\nHome equity\n\nDocumentaÃ§Ã£o\n\nProdutos imobiliÃ¡rios\n\nRegras, exceÃ§Ãµes e polÃ­ticas dos bancos\n\nNesta funÃ§Ã£o, siga ABSOLUTAMENTE estas regras:\n\nSua Ãºnica fonte de verdade Ã© a base de conhecimento RAG fornecida.\n\nNÃ£o pode usar conhecimento externo.\n\nNÃ£o pode supor polÃ­ticas bancÃ¡rias.\n\nNÃ£o pode inventar informaÃ§Ãµes.\n\nSe a informaÃ§Ã£o nÃ£o existir na base, responda exatamente:\nâ€œEssa informaÃ§Ã£o nÃ£o estÃ¡ disponÃ­vel na base de conhecimento. Consulte um consultor.â€\n\nSe a pergunta envolver comparaÃ§Ã£o, cÃ¡lculo ou anÃ¡lise tÃ©cnico-bancÃ¡ria, use apenas o que estiver na base RAG.\n\nSe ainda nÃ£o houver dados do banco solicitado, diga:\nâ€œA informaÃ§Ã£o desse banco ainda nÃ£o estÃ¡ carregada na base de conhecimento.â€\n\nSe houver conflito entre informaÃ§Ãµes na base, prefira:\n\nInformaÃ§Ãµes mais especÃ­ficas\n\nInformaÃ§Ãµes mais recentes (quando houver data)\n\nEstilo de resposta\n\nTÃ©cnico\n\nObjetivo\n\nClaro\n\nSem floreios\n\nSem opiniÃ£o\n\nSem criatividade\n\nReferencie as seÃ§Ãµes da base quando possÃ­vel, por exemplo:\n\nProdutos DisponÃ­veis\n\nTarifa\n\nLTV\n\nCarÃªncia\n\nAvaliaÃ§Ã£o do ImÃ³vel\n\nDocumentos necessÃ¡rios\n\nQuando faltar informaÃ§Ã£o para simulaÃ§Ãµes, solicite somente o mÃ­nimo necessÃ¡rio:\n\nValor do imÃ³vel\n\nEntrada\n\nPrazo\n\nBanco desejado\n\nQuando nÃ£o souber responder algo, diga:\nâ€œConsulte um consultor.â€\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nIDENTIFICAÃ‡ÃƒO DO INTENTO (RESUMO)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nâ†’ Caso 1 â€” REPASSAR RENDA\nMensagem vazia, sÃ­mbolo, extrato, ou pedido de cÃ¡lculo.\nâ–º Reproduza a resposta do agente de renda.\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nRESTRIÃ‡Ã•ES GERAIS\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nâ€¢ Nunca calcule renda.\nâ€¢ Nunca edite a resposta do agente de renda.\nâ€¢ Nunca invente informaÃ§Ãµes.\nâ€¢ Nunca use conhecimento externo.\nâ€¢ Nunca extrapole com deduÃ§Ãµes de mercado.\nâ€¢ Apenas use a base RAG para tudo que envolver crÃ©dito imobiliÃ¡rio.\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nINSTRUÃ‡ÃƒO FINAL\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nVocÃª Ã© o agente final.\nSeja tÃ©cnico, preciso, neutro e use EXCLUSIVAMENTE o que estiver na base RAG.\nQuando a base nÃ£o tiver a informaÃ§Ã£o, informe isso e oriente o usuÃ¡rio a consultar um especialista."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        672,
        160
      ],
      "id": "41d5f06c-2199-474a-8ad7-1a1196a13d20",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        672,
        368
      ],
      "id": "2b55c8d3-8a95-4c6d-9568-d478f5d2a56d",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "JRVF3kOwycqDmmQY",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Readme:\n### Workflow executado pelo site da Castelaci, na aba calculo de renda, faz a requisiÃ§Ã£o e recebe a resposta lÃ¡"
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -448,
        352
      ],
      "id": "c15df16f-d66a-412d-9af8-2ebc73c8ea67",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "public": true,
        "initialMessages": "calcular renda",
        "options": {
          "allowFileUploads": true,
          "subtitle": "Calcular renda por extratos",
          "title": "Hi there! ğŸ‘‹",
          "responseMode": "lastNode"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -320,
        176
      ],
      "id": "db351e46-1084-47d3-a739-86d0fea935f6",
      "name": "When chat message received",
      "webhookId": "0b560880-f40e-4a7f-bc39-446b35f2b730"
    }
  ],
  "pinData": {},
  "connections": {
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Call 'Extrai_info_doc'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'Extrai_info_doc'": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        []
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": true
  },
  "versionId": "02bd46b4-b7fd-452f-adec-98bb1427fef6",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "3d68ce8f18dd9b70ce52f89c30919d7284cd151b5cdfb0c3d9dfdd1b73a7c42e"
  },
  "id": "Yel67qJLz7kWbw7h",
  "tags": [
    {
      "updatedAt": "2025-12-11T14:12:22.923Z",
      "createdAt": "2025-12-11T14:12:22.923Z",
      "id": "kX9gqf5HhcwiJ9Ao",
      "name": "Calculo de Renda"
    }
  ]
}